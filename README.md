# 个人博客
博客是CMS（Content Management System ，内容管理系统）
- 博客前台：展示用户的博客内容
- 博客后台：仅开放给博客管理员，对博客资源进行添加，修改和删除等操作。

## 功能设计
![3](.README_images/c4669cfd.png) 

## 数据库
一共4张表，分别是存储管理员(Admin),分类(Category),文章(Post),评论(Comment)
### 1 管理员
个人博客的话，大部分固定信息可以写死在模板中,或是使用自定义的配置存储在配置文件中。
但是我们希望编写的是一个通用的博客平台，我们要把这些信息的设置交给最终的用户

管理员：提供博客信息修改功能，这些信息不能仅仅定义在配置文件中，而要存储到数据库。
用户可以方便地在程序界面修改设置，而不用手动编辑配置文件

### 2 分类
存储文章的类型，且名称不允许重复

### 3 文章
分类与文章需要建立 一对多关系

### 4 评论
评论与文章建立 一对多关系

### 5 回复
重用评论这个class，评论与回复是一对多关系

## 模板
### 前台
![4](.README_images/cad1d72b.png)

### 后台
![5](.README_images/c45eea3d.png)

### 其他模板下载地址
[Bootswatch](https://bootswatch.com/)

[StartBootstrap](https://startbootstrap.com/)

### 模板上下文
在基模板的导航栏以及博客主页需要使用博客的标题，副标题等存储在管理员对象上的数据，为了
避免每个视图函数中渲染模板时传入直接数据，我们在模板上下文处理函数中向模板上下文
添加了管理员对象变量（admin）。在多个页面包含的边栏中包含分类列表，把分类数据传入到模板
上下文中。

## 表单
- 登录表单
- 文章表单
- 分类表单
- 评论表单
- 博客设置表单

## 视图函数
- blog ： 博客主页

## 电子邮件支持
文章有了新评论后发送邮件通知管理员。而且，当管理员回复了读者的评论后，也需要发送邮件提醒读者

这里使用了 Flask-Mail 发送邮件，需要创建.env文件写入环境变量以便发信功能正常

两个场景
- 当文章有新评论时，发送邮件给管理员
- 当某个评论被回复时，发送邮件给被回复用户。


# 博客前台
前台包括所有用户，包括显示文章列表，博客信息，文章内容和评论等功能

## 分页显示文章列表
先在渲染主页模板的index视图中的数据库获取所有文章记录并传入模板，然后在主页模板中
使用for语句迭代所有文章记录，依次渲染文章标题，发表时间和正文


# 开发学习
## 一 扩展
### Flask-Login
实现用户认证，区分请求的来源客户端的身份，根据不同的身份返回不同的响应

### Unidecode


## 二 蓝本
### 1. 视图函数 route()装饰器注册
![1](.README_images/b8978d40.png)

### 2. 错误处理函数
- 使用蓝本实例的errorhandler()装饰器把错误处理器注册到蓝本上，这些错误处理器只会捕捉
访问该蓝本中的路由发生的错误；
- 使用蓝本实例的app_errorhandler()装饰器可以注册一个全局的错误处理器

### 3. 请求处理函数
- 在蓝本中，使用before_request,after_request,teardown_request等装饰器注册的请求
处理函数是蓝本独有的，也就是说，只有该蓝本中的视图函数对应的请求才会触发相应的请求
处理函数。
- before_app_request,after_app_request,teardown_app_request,before_app_first_request方法，
这些方法注册的请求处理函数是全局的

### 4. 模板上下文处理函数
- 蓝本实例可以使用context_processor装饰器注册蓝本特有的模板上下文处理器；
- 使用app_context_processor装饰器则会注册程序全局的模板上下文处理器

### 5. 蓝本资源
![2](.README_images/5006f9ed.png)

## 三 app
### flask run
```shell script
flask run
```
Flask的自动发现程序实例机制还包含另一种行为：Flask 会自动从环境变量FLASK_APP的值定义的模块中寻找名为create_app()或make_app()的工厂函数
自动从环境变量FLASK_APP的值定义的模块中寻找名为create_app()或make_app()的工厂函数
自动调用工厂函数创建程序实例并运行。

.flaskenv文件中将FLASK_APP设定为bluelog，所以不需要更改任何设置

### current_app
表示当前程序实例的代理对象。某个程序实例被创建并运行时，它会自动指向当前运行的程序实例，并把所有操作转发到当前程序实例

current_app.config
(current_app是程序上下文全局变量，只有激活了程序上下文之后才能使用)

